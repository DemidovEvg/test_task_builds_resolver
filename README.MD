# Микросервис билдов и задач

Данный проект является решением данного [ТЗ](TA.MD). В рамках сервиса необходимо предоставить точку API для получения всех зависимостей билдов в виде упорядоченного списка задач.

Основной стек:
- FastApi
- pydantic
- pytest

### Предварительные условия

* python 3.10^

### Установка

1. Склонировать репозиторий
   ```sh
   git clone ...
   ```
2. Установить зависимости
   ```sh
   pip install -r requirements.txt
   ```
3. При необходимости поменять пути в .env и .test.env
   ```
   PATH_TO_BUILDS="another_builds/builds.yaml"
   PATH_TO_TASKS="another_builds/tasks.yaml"
   RELOAD_FOR_EVERY_REQUEST=FALSE
   ```

## Использование

Запуск микросервиса:
```
uvicorn app:app
```

## Тестирование

Запуск тестов:
```
pytest
```

## Описание

Основные модули/пакеты:
- app.py - В данном модуле находятся точки API для получание доступных списков билдов, а также для получения всех задач билда в виде упорядоченного списка. Для получения списка задач билда необходимо отправить POST запрос по адресу /get-tasks с телом:
   ```
   {
      "build": "forward_interest"
   }
   ```
- model.py - Модуль с моделями данных проекта. Основные модели это Build и Task.
- repo.py - Модуль репозиторий билдов и задач. При старте приложения билды и задачи подгружаются в репозиторий из файлов. Далее из репозитория можно получать как все сущности так и отдельные сущности билдов и задач. В зависимости от настроек проекта реализован опциональный механизм перезагрузки задач из файлов, что позволяет динамически изменять содержимое файлов builds.yaml, tasks.yaml.
- services.py - В данном модуле находится сервис для решения всех зависимостей билда. Зависимости собираются по всему каскаду билд->задачи билда->зависимости с учетом сохранения относительного порядка на уровне билдов и их непосредсвенных задач билда, а также на уровне задач и их прямых зависимостей.
- tests - Пакет в котором собран функционал для проведения основных тестов проекта.

